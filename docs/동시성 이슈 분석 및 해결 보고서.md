# 동시성 이슈 분석 및 해결 보고서

## 선착순 쿠폰 발급

### 문제

```java
필요: 0  
실제: 6
```

### 낙관적 락 시도

| 스레드            | 실행시간 (ms) |
| ----------------- | ------------- |
| pool-2-thread-4   | 395           |
| pool-2-thread-1   | 391           |
| pool-2-thread-9   | 387           |
| pool-2-thread-2   | 386           |
| pool-2-thread-6   | 394           |
| pool-2-thread-7   | 423           |
| pool-2-thread-5   | 395           |
| pool-2-thread-10* | 473           |
| pool-2-thread-8   | 492           |
| pool-2-thread-3   | 496           |

### 비관적 락 시도

| 스레드            | 실행시간 (ms) |
| ----------------- | ------------- |
| pool-2-thread-1   | 339           |
| pool-2-thread-9   | 287           |
| pool-2-thread-10  | 310           |
| pool-2-thread-8   | 334           |
| pool-2-thread-3   | 465           |
| pool-2-thread-7   | 372           |
| pool-2-thread-5   | 397           |
| pool-2-thread-2   | 521           |
| pool-2-thread-6   | 448           |
| pool-2-thread-4   | 467           |

### 낙관적 락 vs 비관적 락 통계 비교

#### 낙관적 락

| 항목     | 값     |
| -------- | ------ |
| 최소     | 386    |
| 최대     | 496    |
| 평균     | 423.2  |
| 중앙값   | 395    |
| 표준편차 | 43.23  |

#### 비관적 락

| 항목     | 값     |
| -------- | ------ |
| 최소     | 287    |
| 최대     | 521    |
| 평균     | 394    |
| 중앙값   | 384.5  |
| 표준편차 | 78.2   |

### 결론

남은 수량이 핵심이고, 실패 가능성을 0으로 보장해야 하므로 재시도 없이 **비관적 락**을 즉시 적용

---

## 포인트 사용

### 문제

```java
필요: 0  
실제: 9000.00
```

### 낙관적 락 시도

| 스레드            | 실행시간 (ms) |
| ----------------- | ------------- |
| pool-2-thread-4   | 362           |
| pool-2-thread-2   | 339           |
| pool-2-thread-10* | 337           |
| pool-2-thread-8   | 360           |
| pool-2-thread-1   | 340           |
| pool-2-thread-7   | 345           |
| pool-2-thread-9   | 351           |
| pool-2-thread-6   | 331           |
| pool-2-thread-5   | 368           |
| pool-2-thread-3   | 363           |

### 비관적 락 시도

| 스레드            | 실행시간 (ms) |
| ----------------- | ------------- |
| pool-2-thread-3   | 158           |
| pool-2-thread-8   | 167           |
| pool-2-thread-2   | 187           |
| pool-2-thread-4   | 183           |
| pool-2-thread-6   | 196           |
| pool-2-thread-9   | 199           |
| pool-2-thread-1   | 202           |
| pool-2-thread-7   | 200           |
| pool-2-thread-5   | 208           |
| pool-2-thread-10  | 211           |

### 낙관적 락 vs 비관적 락 통계 비교

#### 낙관적 락

| 항목     | 값     |
| -------- | ------ |
| 최소     | 331    |
| 최대     | 368    |
| 평균     | 349.6  |
| 중앙값   | 348.0  |
| 표준편차 | 12.3   |

#### 비관적 락

| 항목     | 값     |
| -------- | ------ |
| 최소     | 158    |
| 최대     | 211    |
| 평균     | 191.1  |
| 중앙값   | 197.5  |
| 표준편차 | 17.4   |

### 결론

포인트 사용은 개별 사용자 단위로 발생하므로 **낙관적 락** 적용 후, 충돌 시 예외를 감지하여 재시도

---

## 포인트 충전

### 문제

```java
필요: 20000  
실제: 14000.00
```

### 낙관적 락 시도

| 스레드            | 실행시간 (ms) |
| ----------------- | ------------- |
| pool-2-thread-2   | 583           |
| pool-2-thread-4   | 588           |
| pool-2-thread-3   | 618           |
| pool-2-thread-5   | 620           |
| pool-2-thread-1   | 620           |
| pool-2-thread-7   | 605           |
| pool-2-thread-10* | 654           |
| pool-2-thread-8   | 479           |
| pool-2-thread-6   | 569           |
| pool-2-thread-9   | 629           |

### 비관적 락 시도

| 스레드            | 실행시간 (ms) |
| ----------------- | ------------- |
| pool-2-thread-4   | 146           |
| pool-2-thread-3   | 186           |
| pool-2-thread-10  | 173           |
| pool-2-thread-2   | 195           |
| pool-2-thread-5   | 201           |
| pool-2-thread-6   | 209           |
| pool-2-thread-8   | 209           |
| pool-2-thread-1   | 221           |
| pool-2-thread-7   | 225           |
| pool-2-thread-9   | 229           |

### 낙관적 락 vs 비관적 락 통계 비교

#### 낙관적 락

| 항목     | 값     |
| -------- | ------ |
| 최소     | 479    |
| 최대     | 654    |
| 평균     | 596.5  |
| 중앙값   | 611.5  |
| 표준편차 | 45.6   |

#### 비관적 락

| 항목     | 값     |
| -------- | ------ |
| 최소     | 146    |
| 최대     | 229    |
| 평균     | 199.4  |
| 중앙값   | 205.0  |
| 표준편차 | 25.7   |

### 결론

포인트 충전은 개별 사용자 단위로 발생하므로 **낙관적 락** 적용 후, 충돌 시 예외를 감지하여 재시도

---

## 주문

### 문제

```java
필요: 10  
실제: 13
```

### 낙관적 락 시도

| 스레드            | 실행시간 (ms) |
| ----------------- | ------------- |
| pool-2-thread-7   | 77            |
| pool-2-thread-6   | 199           |
| pool-2-thread-5   | 216           |
| pool-2-thread-8   | 101           |
| pool-2-thread-4   | 200           |
| pool-2-thread-9   | 117           |
| pool-2-thread-10* | 98            |
| pool-2-thread-3   | 94            |
| pool-2-thread-2   | 115           |
| pool-2-thread-1   | 125           |

### 비관적 락 시도

| 스레드            | 실행시간 (ms) |
| ----------------- | ------------- |
| pool-2-thread-4   | 123           |
| pool-2-thread-1   | 139           |
| pool-2-thread-9   | 158           |
| pool-2-thread-6   | 166           |
| pool-2-thread-2   | 179           |
| pool-2-thread-8   | 185           |
| pool-2-thread-5   | 197           |
| pool-2-thread-7   | 210           |
| pool-2-thread-3   | 224           |
| pool-2-thread-10  | 233           |

### 낙관적 락 vs 비관적 락 통계 비교

#### 낙관적 락

| 항목     | 값     |
| -------- | ------ |
| 최소     | 77     |
| 최대     | 216    |
| 평균     | 134.2  |
| 중앙값   | 116.0  |
| 표준편차 | 48.3   |

#### 비관적 락

| 항목     | 값     |
| -------- | ------ |
| 최소     | 123    |
| 최대     | 233    |
| 평균     | 181.4  |
| 중앙값   | 182.0  |
| 표준편차 | 35.8   |

### 결론

재고는 충돌 확률이 높고 인기 상품 주문이 집중될 수 있으므로 **비관적 락** 적용

---

\* `pool-2-thread-10`은 로그의 오타(`ool-2-thread-10`)를 수정한 것입니다.